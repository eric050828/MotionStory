openapi: 3.0.3
info:
  title: MotionStory Profiles API
  description: å€‹äººå…¬é–‹æª”æ¡ˆ APIï¼Œæ”¯æ´æª”æ¡ˆç®¡ç†ã€éš±ç§æ§åˆ¶èˆ‡ QR Code ç”Ÿæˆ
  version: 1.0.0
  contact:
    name: MotionStory API Team

servers:
  - url: https://api.motionstory.com/api/v1
    description: Production server
  - url: http://localhost:8000/api/v1
    description: Development server

tags:
  - name: Profiles
    description: å€‹äººæª”æ¡ˆç›¸é—œæ“ä½œ

paths:
  /profiles/me:
    get:
      tags:
        - Profiles
      summary: å–å¾—å€‹äººæª”æ¡ˆ
      description: å–å¾—ç•¶å‰ä½¿ç”¨è€…çš„å®Œæ•´å€‹äººæª”æ¡ˆ
      operationId: getMyProfile
      security:
        - BearerAuth: []
      responses:
        '200':
          description: æŸ¥è©¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Profile'
        '401':
          $ref: '#/components/responses/Unauthorized'

    put:
      tags:
        - Profiles
      summary: æ›´æ–°å€‹äººæª”æ¡ˆ
      description: |
        æ›´æ–°å€‹äººæª”æ¡ˆè³‡è¨Š
        - æ”¯æ´æ›´æ–°é ­åƒã€æš±ç¨±ã€è‡ªæˆ‘ä»‹ç´¹ã€é‹å‹•æ¨™ç±¤
        - æ”¯æ´éš±ç§å±¤ç´šè¨­å®š
      operationId: updateMyProfile
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                display_name:
                  type: string
                  minLength: 1
                  maxLength: 50
                  description: é¡¯ç¤ºåç¨±
                avatar_url:
                  type: string
                  nullable: true
                  description: é ­åƒ URL
                bio:
                  type: string
                  maxLength: 100
                  nullable: true
                  description: è‡ªæˆ‘ä»‹ç´¹
                sport_tags:
                  type: array
                  items:
                    type: string
                  maxItems: 5
                  description: é‹å‹•æ¨™ç±¤ï¼ˆæœ€å¤š 5 å€‹ï¼‰
                privacy_level:
                  type: string
                  enum: [public, friends_only, private]
                  description: éš±ç§å±¤ç´š
            example:
              display_name: "Runner Jane"
              bio: "é¦¬æ‹‰æ¾æ„›å¥½è€… ğŸƒâ€â™€ï¸"
              sport_tags: ["è·‘æ­¥", "é¦¬æ‹‰æ¾", "å¥èº«"]
              privacy_level: friends_only
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Profile'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /profiles/{user_id}:
    get:
      tags:
        - Profiles
      summary: æŸ¥çœ‹ä»–äººæª”æ¡ˆ
      description: |
        æŸ¥çœ‹æŒ‡å®šä½¿ç”¨è€…çš„å…¬é–‹æª”æ¡ˆ
        - æ ¹æ“šéš±ç§è¨­å®šæ±ºå®šå¯è¦‹å…§å®¹
        - å…¬é–‹: æ‰€æœ‰äººå¯æŸ¥çœ‹
        - åƒ…å¥½å‹: åƒ…å¥½å‹å¯æŸ¥çœ‹å®Œæ•´è³‡è¨Š
        - ç§å¯†: åƒ…é¡¯ç¤ºåŸºæœ¬è³‡è¨Šï¼ˆæš±ç¨±ã€é ­åƒï¼‰
      operationId: getUserProfile
      security:
        - BearerAuth: []
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: æŸ¥è©¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PublicProfile'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: ç„¡æ¬Šé™æŸ¥çœ‹ï¼ˆéš±ç§è¨­å®šç‚ºç§å¯†ä¸”éå¥½å‹ï¼‰
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          $ref: '#/components/responses/NotFound'

  /profiles/me/qrcode:
    get:
      tags:
        - Profiles
      summary: å–å¾—å€‹äºº QR Code
      description: |
        ç”Ÿæˆå€‹äºº QR Code ç”¨æ–¼å¿«é€ŸåŠ å¥½å‹
        - QR Code åŒ…å«ä½¿ç”¨è€… ID
        - æ”¯æ´ PNG æˆ– SVG æ ¼å¼
      operationId: getMyQRCode
      security:
        - BearerAuth: []
      parameters:
        - name: format
          in: query
          schema:
            type: string
            enum: [png, svg]
            default: png
          description: QR Code æ ¼å¼
        - name: size
          in: query
          schema:
            type: integer
            default: 300
            minimum: 100
            maximum: 1000
          description: QR Code å°ºå¯¸ï¼ˆåƒç´ ï¼‰
      responses:
        '200':
          description: ç”ŸæˆæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  qrcode_data:
                    type: string
                    description: QR Code æ•¸æ“šï¼ˆBase64 ç·¨ç¢¼çš„åœ–ç‰‡æˆ– SVG å­—ä¸²ï¼‰
                  qrcode_url:
                    type: string
                    description: QR Code åœ–ç‰‡ URLï¼ˆå¯é¸ï¼Œè‹¥å¾Œç«¯å­˜å„²ï¼‰
                  format:
                    type: string
                  size:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'

  /profiles/stats/{user_id}:
    get:
      tags:
        - Profiles
      summary: å–å¾—ä½¿ç”¨è€…çµ±è¨ˆæ•¸æ“š
      description: |
        å–å¾—æŒ‡å®šä½¿ç”¨è€…çš„é‹å‹•çµ±è¨ˆæ•¸æ“š
        - æ ¹æ“šéš±ç§è¨­å®šæ±ºå®šå¯è¦‹å…§å®¹
      operationId: getUserStats
      security:
        - BearerAuth: []
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: æŸ¥è©¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserStats'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: ç„¡æ¬Šé™æŸ¥çœ‹çµ±è¨ˆæ•¸æ“š
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          $ref: '#/components/responses/NotFound'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Profile:
      type: object
      properties:
        user_id:
          type: string
        display_name:
          type: string
        avatar_url:
          type: string
          nullable: true
        bio:
          type: string
          nullable: true
          description: è‡ªæˆ‘ä»‹ç´¹ï¼ˆæœ€å¤š 100 å­—ï¼‰
        sport_tags:
          type: array
          items:
            type: string
          description: é‹å‹•æ¨™ç±¤ï¼ˆæœ€å¤š 5 å€‹ï¼‰
        privacy_level:
          type: string
          enum: [public, friends_only, private]
        stats:
          $ref: '#/components/schemas/UserStats'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    PublicProfile:
      type: object
      properties:
        user_id:
          type: string
        display_name:
          type: string
        avatar_url:
          type: string
          nullable: true
        bio:
          type: string
          nullable: true
          description: è‡ªæˆ‘ä»‹ç´¹ï¼ˆæ ¹æ“šéš±ç§è¨­å®šå¯èƒ½ç‚º nullï¼‰
        sport_tags:
          type: array
          items:
            type: string
          description: é‹å‹•æ¨™ç±¤ï¼ˆæ ¹æ“šéš±ç§è¨­å®šå¯èƒ½ç‚ºç©ºï¼‰
        privacy_level:
          type: string
          enum: [public, friends_only, private]
        is_friend:
          type: boolean
          description: æ˜¯å¦ç‚ºå¥½å‹
        stats:
          nullable: true
          description: çµ±è¨ˆæ•¸æ“šï¼ˆæ ¹æ“šéš±ç§è¨­å®šå¯èƒ½ç‚º nullï¼‰
          allOf:
            - $ref: '#/components/schemas/UserStats'

    UserStats:
      type: object
      properties:
        total_workout_days:
          type: integer
          description: ç¸½é‹å‹•å¤©æ•¸
        total_distance:
          type: number
          description: ç¸½è·é›¢ï¼ˆå…¬é‡Œï¼‰
        total_duration:
          type: integer
          description: ç¸½æ™‚é•·ï¼ˆåˆ†é˜ï¼‰
        favorite_workout_type:
          type: string
          nullable: true
          description: æœ€æ„›é‹å‹•é¡å‹
        achievement_count:
          type: integer
          description: æˆå°±æ•¸é‡
        current_streak:
          type: integer
          description: ç•¶å‰é€£çºŒå¤©æ•¸
        longest_streak:
          type: integer
          description: æœ€é•·é€£çºŒå¤©æ•¸
        last_workout_at:
          type: string
          format: date-time
          nullable: true
          description: æœ€å¾Œé‹å‹•æ™‚é–“

    Error:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
        details:
          type: object
          nullable: true

  responses:
    BadRequest:
      description: è«‹æ±‚åƒæ•¸éŒ¯èª¤
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    Unauthorized:
      description: æœªæˆæ¬Šæˆ– Token ç„¡æ•ˆ
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    NotFound:
      description: è³‡æºä¸å­˜åœ¨
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
